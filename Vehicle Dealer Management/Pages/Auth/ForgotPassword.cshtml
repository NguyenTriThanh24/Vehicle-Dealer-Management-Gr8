@page "/ForgotPassword"
@model Vehicle_Dealer_Management.Pages.Auth.ForgotPasswordModel
@{
    Layout = "_LayoutPublic";
    ViewData["Title"] = "Quên mật khẩu";
}

<div class="content" style="display: flex; align-items: center; justify-content: center; min-height: calc(100vh - 80px);">
    <div class="card" style="max-width: 480px; width: 100%;">
        <div class="card-header text-center">
            <h2 class="card-title">Quên mật khẩu</h2>
            <p class="card-subtitle">Nhập email để nhận mã đặt lại mật khẩu</p>
        </div>
        
        <div class="card-body">
            <form method="post">
                <div class="form-group">
                    <label class="form-label" for="email">Email</label>
                    <input type="email" class="form-control" id="email" name="email" value="@Model.Email" placeholder="you@example.com" required />
                </div>

                <div class="form-group">
                    <button type="submit" class="btn btn-primary btn-block">
                        <i class="bi bi-envelope"></i>
                        Gửi mã đặt lại
                    </button>
                </div>

                @if (Model.ErrorMessage != null)
                {
                    <div class="alert alert-danger" style="background: var(--error-bg); color: var(--error); border: 1px solid var(--error); padding: 1rem; border-radius: var(--radius-sm); margin-top: 1rem;">
                        <i class="bi bi-exclamation-triangle"></i> @Model.ErrorMessage
                    </div>
                }

                @if (Model.SuccessMessage != null)
                {
                    <div class="alert alert-success" style="background: var(--success-bg); color: var(--success); border: 1px solid var(--success); padding: 1rem; border-radius: var(--radius-sm); margin-top: 1rem;">
                        <i class="bi bi-check-circle"></i> @Model.SuccessMessage
                    </div>
                }

                @if (!string.IsNullOrEmpty(Model.ResetToken))
                {
                    <div class="alert alert-info" style="background: var(--info-bg); color: var(--info); border: 1px solid var(--info); padding: 1rem; border-radius: var(--radius-sm); margin-top: 1rem;">
                        <div style="margin-bottom: 0.5rem;">
                            <strong><i class="bi bi-key"></i> Mã đặt lại mật khẩu (Test Mode):</strong>
                        </div>
                        <div style="display: flex; gap: 0.5rem; align-items: center;">
                            <code id="resetToken" style="flex: 1; padding: 0.75rem; background: rgba(0,0,0,0.3); border-radius: var(--radius-sm); font-size: 1.2rem; text-align: center; font-weight: bold; font-family: 'Courier New', monospace; letter-spacing: 0.2rem;">@Model.ResetToken</code>
                            <button type="button" class="btn btn-sm" onclick="copyToken()" style="white-space: nowrap;" title="Copy mã">
                                <i class="bi bi-clipboard"></i> Copy
                            </button>
                        </div>
                        <div style="margin-top: 0.5rem; font-size: 0.85rem; opacity: 0.8;">
                            <i class="bi bi-info-circle"></i> Mã này chỉ dùng cho test local. Trong môi trường thực tế, mã sẽ được gửi qua email.
                        </div>
                        <div style="margin-top: 1rem; padding-top: 1rem; border-top: 1px solid rgba(255,255,255,0.1);">
                            <a href="/ResetPassword?email=@Model.Email&token=@Model.ResetToken" class="btn btn-primary btn-block">
                                <i class="bi bi-arrow-right"></i> Đặt lại mật khẩu ngay
                            </a>
                        </div>
                    </div>
                }
            </form>
        </div>

        <div class="card-footer text-center">
            <p class="text-muted mb-0">
                <a href="/Login">Quay lại đăng nhập</a>
            </p>
        </div>
    </div>
</div>

<script>
    function copyToken() {
        const tokenElement = document.getElementById('resetToken');
        const text = tokenElement.textContent;
        
        navigator.clipboard.writeText(text).then(() => {
            const btn = event.currentTarget;
            const originalHTML = btn.innerHTML;
            btn.innerHTML = '<i class="bi bi-check"></i> Đã copy';
            btn.style.background = 'var(--success)';
            setTimeout(() => {
                btn.innerHTML = originalHTML;
                btn.style.background = '';
            }, 2000);
        }).catch(err => {
            alert('Không thể copy mã. Vui lòng copy thủ công: ' + text);
        });
    }
</script>

