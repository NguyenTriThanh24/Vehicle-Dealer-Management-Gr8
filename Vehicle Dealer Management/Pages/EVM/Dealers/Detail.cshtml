@page "/EVM/Dealers/Detail"
@model Vehicle_Dealer_Management.Pages.EVM.Dealers.DetailModel
@{
    ViewData["Title"] = "Chi tiết đại lý";
    ViewData["UserRole"] = "EVM_STAFF";
    ViewData["UserName"] = HttpContext.Session.GetString("UserName") ?? "EVM Staff";
}

<div class="content-header">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="content-title">@Model.Dealer.Name</h1>
            <p class="content-subtitle">Thông tin chi tiết đại lý</p>
        </div>
        <a href="/EVM/Dealers" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Quay lại
        </a>
    </div>
</div>

@await Html.PartialAsync("_InlineAlert", "Error")

<!-- Stats -->
<div class="grid grid-cols-5 mb-4">
    <div class="stat-card">
        <div class="stat-label">Trạng thái</div>
        <div class="stat-value">
            @await Html.PartialAsync("_StatusBadge", Model.Dealer.Status)
        </div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Số nhân viên</div>
        <div class="stat-value">@Model.Dealer.StaffCount</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Tổng đơn hàng</div>
        <div class="stat-value" style="color: var(--accent-cyan);">@Model.Dealer.TotalOrders</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Tổng doanh số</div>
        <div class="stat-value" style="color: var(--success);">@Model.Dealer.TotalSales.ToString("N0") VND</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Công nợ</div>
        <div class="stat-value" style="color: var(--warning);">@Model.Dealer.TotalDebt.ToString("N0") VND</div>
    </div>
</div>

<div class="grid grid-cols-3 gap-3">
    <!-- Left: Dealer Info -->
    <div>
        <div class="card mb-3">
            <div class="card-header">
                <h3 class="card-title mb-0">Thông tin đại lý</h3>
            </div>
            <div class="card-body">
                <div class="mb-3">
                    <label class="form-label" style="color: var(--text-muted); font-size: 0.875rem;">Tên đại lý</label>
                    <div style="font-size: 1rem; font-weight: 600;">@Model.Dealer.Name</div>
                </div>
                <div class="mb-3">
                    <label class="form-label" style="color: var(--text-muted); font-size: 0.875rem;">Địa chỉ</label>
                    <div>@Model.Dealer.Address</div>
                </div>
                <div class="mb-3">
                    <label class="form-label" style="color: var(--text-muted); font-size: 0.875rem;">Số điện thoại</label>
                    <div>@Model.Dealer.Phone</div>
                </div>
                <div class="mb-3">
                    <label class="form-label" style="color: var(--text-muted); font-size: 0.875rem;">Email</label>
                    <div>@Model.Dealer.Email</div>
                </div>
                <div class="mb-0">
                    <label class="form-label" style="color: var(--text-muted); font-size: 0.875rem;">Ngày tạo</label>
                    <div>@Model.Dealer.CreatedDate.ToString("dd/MM/yyyy")</div>
                </div>
            </div>
        </div>

        <!-- Stock Summary -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title mb-0">Tồn kho</h3>
            </div>
            <div class="card-body">
                @if (Model.Dealer.StockSummary.Any())
                {
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Xe</th>
                                    <th>Số lượng</th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var stock in Model.Dealer.StockSummary)
                                {
                                    <tr>
                                        <td>@stock.VehicleName</td>
                                        <td><strong>@stock.TotalQty</strong></td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="text-center text-muted" style="padding: 2rem;">
                        Chưa có tồn kho
                    </div>
                }
            </div>
        </div>
    </div>

    <!-- Right: Orders & Debt -->
    <div style="grid-column: span 2;">
        <!-- Debt Summary -->
        <div class="card mb-3">
            <div class="card-header">
                <h3 class="card-title mb-0">Công nợ</h3>
            </div>
            <div class="card-body">
                <div class="grid grid-cols-3 gap-3">
                    <div>
                        <label class="form-label" style="color: var(--text-muted); font-size: 0.875rem;">Tổng doanh số</label>
                        <div style="font-size: 1.25rem; font-weight: 600; color: var(--accent-cyan);">
                            @Model.Dealer.TotalSales.ToString("N0") VND
                        </div>
                    </div>
                    <div>
                        <label class="form-label" style="color: var(--text-muted); font-size: 0.875rem;">Đã thanh toán</label>
                        <div style="font-size: 1.25rem; font-weight: 600; color: var(--success);">
                            @Model.Dealer.TotalPaid.ToString("N0") VND
                        </div>
                    </div>
                    <div>
                        <label class="form-label" style="color: var(--text-muted); font-size: 0.875rem;">Còn nợ</label>
                        <div style="font-size: 1.25rem; font-weight: 600; color: var(--warning);">
                            @Model.Dealer.TotalDebt.ToString("N0") VND
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Recent Orders -->
        <div class="card">
            <div class="card-header">
                <h3 class="card-title mb-0">Đơn hàng gần đây</h3>
            </div>
            <div class="card-body">
                @if (Model.Dealer.RecentOrders.Any())
                {
                    <div class="table-container">
                        <table class="table">
                            <thead>
                                <tr>
                                    <th>Mã đơn</th>
                                    <th>Khách hàng</th>
                                    <th>Tổng tiền</th>
                                    <th>Đã trả</th>
                                    <th>Trạng thái</th>
                                    <th>Ngày tạo</th>
                                    <th></th>
                                </tr>
                            </thead>
                            <tbody>
                                @foreach (var order in Model.Dealer.RecentOrders)
                                {
                                    <tr>
                                        <td><strong>@order.OrderNumber</strong></td>
                                        <td>@order.CustomerName</td>
                                        <td><strong>@order.TotalAmount.ToString("N0") VND</strong></td>
                                        <td>@order.PaidAmount.ToString("N0") VND</td>
                                        <td>@await Html.PartialAsync("_StatusBadge", order.Status)</td>
                                        <td>@order.CreatedAt.ToString("dd/MM/yyyy")</td>
                                        <td>
                                            <a href="/Dealer/Sales/OrderDetail?id=@order.Id" class="btn btn-secondary btn-sm" target="_blank">
                                                <i class="bi bi-eye"></i> Xem
                                            </a>
                                        </td>
                                    </tr>
                                }
                            </tbody>
                        </table>
                    </div>
                }
                else
                {
                    <div class="text-center text-muted" style="padding: 2rem;">
                        Chưa có đơn hàng
                    </div>
                }
            </div>
        </div>
    </div>
</div>

