@page
@model Vehicle_Dealer_Management.Pages.EVM.Vehicles.CreateModel
@{
    ViewData["Title"] = "Thêm xe mới";
    ViewData["UserRole"] = "EVM_STAFF";
    ViewData["UserName"] = HttpContext.Session.GetString("UserName") ?? "EVM Staff";
}

<div class="content-header">
    <div class="flex justify-between items-center">
        <div>
            <h1 class="content-title">Thêm xe mới</h1>
            <p class="content-subtitle">Thêm mẫu xe điện mới vào hệ thống</p>
        </div>
        <a href="/EVM/Vehicles/Index" class="btn btn-secondary">
            <i class="bi bi-arrow-left"></i> Quay lại
        </a>
    </div>
</div>

<form method="post" enctype="multipart/form-data">
    <div class="grid grid-cols-3 gap-3">
        <!-- Left Column: Vehicle Info -->
        <div style="grid-column: span 2;">
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title mb-0">Thông tin cơ bản</h3>
                </div>
                <div class="card-body">
                    <div class="grid grid-cols-2 gap-2">
                        <div class="form-group">
                            <label class="form-label">Tên mẫu xe <span style="color: var(--error);">*</span></label>
                            <input type="text" class="form-control" name="modelName" placeholder="Ví dụ: Model 3" required />
                            <small class="form-text">Tên chính của dòng xe</small>
                        </div>

                        <div class="form-group">
                            <label class="form-label">Phiên bản <span style="color: var(--error);">*</span></label>
                            <input type="text" class="form-control" name="variantName" placeholder="Ví dụ: Standard" required />
                            <small class="form-text">Phiên bản: Standard, Premium, Performance...</small>
                        </div>
                    </div>

                    <div class="form-group">
                        <label class="form-label">URL hình ảnh <span style="color: var(--error);">*</span></label>
                        <input type="url" class="form-control" name="imageUrl" placeholder="https://example.com/image.jpg" required />
                        <small class="form-text">Link ảnh xe (có thể dùng Unsplash, Imgur...)</small>
                    </div>

                    <div class="form-group mb-0">
                        <label class="form-label">Trạng thái</label>
                        <select class="form-control" name="status">
                            <option value="AVAILABLE">Có sẵn (AVAILABLE)</option>
                            <option value="COMING_SOON">Sắp ra mắt (COMING_SOON)</option>
                            <option value="DISCONTINUED">Ngừng sản xuất (DISCONTINUED)</option>
                        </select>
                    </div>
                </div>
            </div>

            <!-- Specifications -->
            <div class="card">
                <div class="card-header">
                    <h3 class="card-title mb-0">Thông số kỹ thuật</h3>
                </div>
                <div class="card-body">
                    <div class="grid grid-cols-2 gap-2">
                        <div class="form-group">
                            <label class="form-label">Dung lượng pin</label>
                            <input type="text" class="form-control" name="battery" placeholder="Ví dụ: 75kWh" />
                        </div>

                        <div class="form-group">
                            <label class="form-label">Quãng đường</label>
                            <input type="text" class="form-control" name="range" placeholder="Ví dụ: 500km" />
                        </div>

                        <div class="form-group">
                            <label class="form-label">Công suất</label>
                            <input type="text" class="form-control" name="power" placeholder="Ví dụ: 350hp" />
                        </div>

                        <div class="form-group">
                            <label class="form-label">Tăng tốc 0-100km/h</label>
                            <input type="text" class="form-control" name="acceleration" placeholder="Ví dụ: 4.5s" />
                        </div>

                        <div class="form-group">
                            <label class="form-label">Tốc độ tối đa</label>
                            <input type="text" class="form-control" name="maxSpeed" placeholder="Ví dụ: 220km/h" />
                        </div>

                        <div class="form-group">
                            <label class="form-label">Số chỗ ngồi</label>
                            <input type="number" class="form-control" name="seats" placeholder="5" />
                        </div>
                    </div>

                    <div class="form-group mb-0">
                        <label class="form-label">Thông số khác (JSON)</label>
                        <textarea class="form-control" name="otherSpecs" rows="4" placeholder='{"transmission": "Automatic", "drivetrain": "AWD"}'></textarea>
                        <small class="form-text">Các thông số bổ sung dạng JSON (tùy chọn)</small>
                    </div>
                </div>
            </div>
        </div>

        <!-- Right Column: Preview & Actions -->
        <div>
            <!-- Preview Card -->
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title mb-0">Preview</h3>
                </div>
                <div class="card-body">
                    <div id="preview-image" style="width: 100%; height: 200px; background: var(--black); border-radius: var(--radius-sm); display: flex; align-items: center; justify-content: center; margin-bottom: 1rem; overflow: hidden;">
                        <i class="bi bi-image" style="font-size: 3rem; color: var(--text-muted);"></i>
                    </div>
                    <div id="preview-name" style="font-size: 1.25rem; font-weight: 600; color: var(--text-heading); margin-bottom: 0.5rem;">
                        Model Name Variant
                    </div>
                    <div id="preview-specs" class="text-muted" style="font-size: 0.875rem;">
                        Thông số sẽ hiển thị ở đây
                    </div>
                </div>
            </div>

            <!-- Initial Price & Stock -->
            <div class="card mb-3">
                <div class="card-header">
                    <h3 class="card-title mb-0">Giá và tồn kho ban đầu</h3>
                </div>
                <div class="card-body">
                    <div class="form-group">
                        <label class="form-label">Giá bán lẻ (MSRP)</label>
                        <input type="number" class="form-control" name="msrp" placeholder="1500000000" min="0" step="1000000" />
                        <small class="form-text">Giá niêm yết (VND)</small>
                    </div>

                    <div class="form-group">
                        <label class="form-label">Giá sỉ</label>
                        <input type="number" class="form-control" name="wholesalePrice" placeholder="1400000000" min="0" step="1000000" />
                        <small class="form-text">Giá cho đại lý (VND)</small>
                    </div>

                    <div class="form-group mb-0">
                        <label class="form-label">Tồn kho EVM ban đầu</label>
                        <input type="number" class="form-control" name="initialStock" placeholder="10" min="0" />
                        <small class="form-text">Số lượng xe trong kho EVM</small>
                    </div>
                </div>
            </div>

            <!-- Actions -->
            <div class="card">
                <div class="card-body">
                    <button type="submit" class="btn btn-primary btn-block mb-2">
                        <i class="bi bi-check-circle"></i> Thêm xe mới
                    </button>
                    <a href="/EVM/Vehicles/Index" class="btn btn-secondary btn-block">
                        Hủy
                    </a>
                </div>
            </div>

            @if (Model.ErrorMessage != null)
            {
                <div style="background: var(--error-bg); color: var(--error); border: 1px solid var(--error); padding: 1rem; border-radius: var(--radius-sm); margin-top: 1rem;">
                    <i class="bi bi-exclamation-triangle"></i> @Model.ErrorMessage
                </div>
            }
        </div>
    </div>
</form>

@section Scripts {
    <script>
        // Preview image
        document.querySelector('input[name="imageUrl"]')?.addEventListener('input', function() {
            const url = this.value;
            const preview = document.getElementById('preview-image');
            if (url) {
                preview.innerHTML = '<img src="' + url + '" style="width: 100%; height: 100%; object-fit: cover;" onerror="this.parentElement.innerHTML=\'<i class=\\'bi bi-image-fill\\' style=\\'font-size: 3rem; color: var(--error);\\></i>\'" />';
            }
        });

        // Preview name
        const updatePreview = () => {
            const modelName = document.querySelector('input[name="modelName"]').value || 'Model Name';
            const variantName = document.querySelector('input[name="variantName"]').value || 'Variant';
            document.getElementById('preview-name').textContent = modelName + ' ' + variantName;
        };
        
        document.querySelector('input[name="modelName"]')?.addEventListener('input', updatePreview);
        document.querySelector('input[name="variantName"]')?.addEventListener('input', updatePreview);

        // Preview specs
        const updateSpecs = () => {
            const battery = document.querySelector('input[name="battery"]').value;
            const range = document.querySelector('input[name="range"]').value;
            const power = document.querySelector('input[name="power"]').value;
            
            let specs = [];
            if (battery) specs.push('Pin: ' + battery);
            if (range) specs.push('Quãng đường: ' + range);
            if (power) specs.push('Công suất: ' + power);
            
            document.getElementById('preview-specs').textContent = specs.join(' • ') || 'Thông số sẽ hiển thị ở đây';
        };
        
        ['battery', 'range', 'power'].forEach(name => {
            document.querySelector('input[name="' + name + '"]')?.addEventListener('input', updateSpecs);
        });
    </script>
}

