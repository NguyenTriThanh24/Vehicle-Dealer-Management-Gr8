@page
@model Vehicle_Dealer_Management.Pages.Admin.Reports.InventoryModel
@{
    ViewData["Title"] = "Phân tích tồn kho";
}

<div class="content-header">
    <h1 class="content-title">Phân tích tồn kho</h1>
    <p class="content-subtitle">Tổng quan tồn kho EVM và đại lý</p>
</div>

<!-- Summary -->
<div class="grid grid-cols-4 mb-4">
    <div class="stat-card">
        <div class="stat-label">Tồn kho tổng</div>
        <div class="stat-value">@Model.TotalInventory</div>
        <div class="text-muted" style="font-size: 0.875rem;">Xe</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Tồn kho EVM</div>
        <div class="stat-value" style="color: var(--accent-cyan);">@Model.EvmStock</div>
        <div class="text-muted" style="font-size: 0.875rem;">@Model.EvmStockPercent.ToString("F1")% tổng</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Tồn kho đại lý</div>
        <div class="stat-value" style="color: var(--success);">@Model.DealerStock</div>
        <div class="text-muted" style="font-size: 0.875rem;">@Model.DealerStockPercent.ToString("F1")% tổng</div>
    </div>
    <div class="stat-card">
        <div class="stat-label">Giá trị tồn kho</div>
        <div class="stat-value">@Model.TotalValue.ToString("N0")</div>
        <div class="text-muted" style="font-size: 0.875rem;">Tỷ VND</div>
    </div>
</div>

<!-- Alerts -->
<div class="grid grid-cols-2 mb-4">
    <div class="card">
        <div class="card-header">
            <h3 class="card-title mb-0" style="color: var(--error);">
                <i class="bi bi-exclamation-triangle"></i> Tồn kho thấp (< 10)
            </h3>
        </div>
        <div class="card-body">
            @if (Model.LowStockItems.Any())
            {
                @foreach (var item in Model.LowStockItems)
                {
                    <div class="flex justify-between items-center" style="padding: 0.75rem; background: var(--error-bg); border: 1px solid var(--error); border-radius: var(--radius-sm); margin-bottom: 0.5rem;">
                        <div>
                            <div><strong>@item.VehicleName</strong></div>
                            <div class="text-muted" style="font-size: 0.875rem;">@item.Location - @item.Color</div>
                        </div>
                        <div style="color: var(--error); font-weight: 700; font-size: 1.25rem;">
                            @item.Qty
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="empty-state">
                    <div class="empty-state-icon">✅</div>
                    <div class="empty-state-text">Tồn kho đủ</div>
                </div>
            }
        </div>
    </div>

    <div class="card">
        <div class="card-header">
            <h3 class="card-title mb-0" style="color: var(--warning);">
                <i class="bi bi-box-seam"></i> Tồn kho cao (> 50)
            </h3>
        </div>
        <div class="card-body">
            @if (Model.HighStockItems.Any())
            {
                @foreach (var item in Model.HighStockItems)
                {
                    <div class="flex justify-between items-center" style="padding: 0.75rem; background: var(--warning-bg); border: 1px solid var(--warning); border-radius: var(--radius-sm); margin-bottom: 0.5rem;">
                        <div>
                            <div><strong>@item.VehicleName</strong></div>
                            <div class="text-muted" style="font-size: 0.875rem;">@item.Location - @item.Color</div>
                        </div>
                        <div style="color: var(--warning); font-weight: 700; font-size: 1.25rem;">
                            @item.Qty
                        </div>
                    </div>
                }
            }
            else
            {
                <div class="empty-state">
                    <div class="empty-state-icon">✅</div>
                    <div class="empty-state-text">Không có tồn kho cao</div>
                </div>
            }
        </div>
    </div>
</div>

<!-- Detailed Inventory -->
<div class="card">
    <div class="card-header">
        <h3 class="card-title mb-0">Chi tiết tồn kho theo xe</h3>
    </div>
    <div class="card-body">
        <div class="table-container">
            <table class="table">
                <thead>
                    <tr>
                        <th>Mẫu xe</th>
                        <th>Tồn EVM</th>
                        <th>Tồn đại lý</th>
                        <th>Tổng</th>
                        <th>Giá trị (Tỷ VND)</th>
                        <th>% Tổng kho</th>
                    </tr>
                </thead>
                <tbody>
                    @foreach (var item in Model.InventoryByVehicle)
                    {
                        var percent = Model.TotalInventory > 0 ? ((decimal)item.Total / Model.TotalInventory * 100) : 0;
                        
                        <tr>
                            <td><strong>@item.VehicleName</strong></td>
                            <td>@item.EvmStock</td>
                            <td>@item.DealerStock</td>
                            <td><strong style="font-size: 1.125rem;">@item.Total</strong></td>
                            <td>@item.Value.ToString("N2")</td>
                            <td>
                                <div class="flex items-center gap-2">
                                    <div style="width: 80px; height: 8px; background: var(--border); border-radius: 4px; overflow: hidden;">
                                        <div style="width: @percent.ToString("F1")%; height: 100%; background: var(--info);"></div>
                                    </div>
                                    <span>@percent.ToString("F1")%</span>
                                </div>
                            </td>
                        </tr>
                    }
                </tbody>
            </table>
        </div>
    </div>
</div>

